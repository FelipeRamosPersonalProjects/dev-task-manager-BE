<h1>Create new Ticket</h1>

<form>
    <fieldset>
        <label>Project:</label>
        ##{{projects:string}}##
    </fieldset>
    <fieldset>
        <label>Ticket ID:</label>
        <input type="text" name="ticketID" />
    </fieldset>

    <fieldset>
        <label>Ticket URL:</label>
        <input type="text" name="ticketURL" />
    </fieldset>

    <fieldset>
        <label>Title:</label>
        <input type="text" name="title" />
    </fieldset>

    <fieldset>
        <label>Description:</label>
        <textarea name="description"></textarea>
    </fieldset>

    <button type="submit">Confirm</button>
</form>

<script>
    document.querySelector('form').addEventListener('submit', (ev) => {
        ev.preventDefault();
        const fields = ev.target.querySelectorAll('[name]');
        const data = {};

        fields.forEach(field => (data[field.name] = field.value));
        data.assignedUsers = [sessionStorage.getItem('currentUserUID')];

        fetch('/collection/create', {
            headers: { 'Content-Type': 'application/json' },
            method: 'post',
            body: JSON.stringify({
                collectionName: 'tickets',
                data
            })
        }).then(res => res.json()).then(data => {
            if (data.error) {
                return alert(data.message);
            }

            return window.location.href = '/dashboard';
        }).catch(err => {
            return alert(err.message);
        });
    });
</script>
